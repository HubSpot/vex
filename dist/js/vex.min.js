!function(e,n){"function"==typeof define&&define.amd?define(n):"object"==typeof exports?module.exports=n(require,exports,module):e.vex=n()}(this,function(e,n,t){"use strict";var a=!1;$(function(){var e=(document.body||document.documentElement).style;return a=void 0!==e.animation||void 0!==e.WebkitAnimation||void 0!==e.MozAnimation||void 0!==e.MsAnimation||void 0!==e.OAnimation,$(window).bind("keyup.vex",function(e){return 27===e.keyCode?s.closeByEscape():void 0})});var s={globalID:1,animationEndEvent:"animationend webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend",baseClassNames:{vex:"vex",content:"vex-content",overlay:"vex-overlay",close:"vex-close",closing:"vex-closing",open:"vex-open"},defaultOptions:{content:"",showCloseButton:!0,escapeButtonCloses:!0,overlayClosesOnClick:!0,appendLocation:"body",className:"",css:{},overlayClassName:"",overlayCSS:{},contentClassName:"",contentCSS:{},closeClassName:"",closeCSS:{}},open:function(e){return e=$.extend({},s.defaultOptions,e),e.id=s.globalID,s.globalID+=1,e.$vex=$("<div>").addClass(s.baseClassNames.vex).addClass(e.className).css(e.css).data({vex:e}),e.$vexOverlay=$("<div>").addClass(s.baseClassNames.overlay).addClass(e.overlayClassName).css(e.overlayCSS).data({vex:e}),e.overlayClosesOnClick&&e.$vexOverlay.bind("click.vex",function(e){return e.target===this?s.close($(this).data().vex.id):void 0}),e.$vex.append(e.$vexOverlay),e.$vexContent=$("<div>").addClass(s.baseClassNames.content).addClass(e.contentClassName).css(e.contentCSS).append(e.content).data({vex:e}),e.$vex.append(e.$vexContent),e.showCloseButton&&(e.$closeButton=$("<div>").addClass(s.baseClassNames.close).addClass(e.closeClassName).css(e.closeCSS).data({vex:e}).bind("click.vex",function(){return s.close($(this).data().vex.id)}),e.$vexContent.append(e.$closeButton)),$(e.appendLocation).append(e.$vex),s.setupBodyClassName(e.$vex),e.afterOpen&&e.afterOpen(e.$vexContent,e),setTimeout(function(){return e.$vexContent.trigger("vexOpen",e)},0),e.$vexContent},getSelectorFromBaseClass:function(e){return"."+e.split(" ").join(".")},getAllVexes:function(){return $("."+s.baseClassNames.vex+':not(".'+s.baseClassNames.closing+'") '+s.getSelectorFromBaseClass(s.baseClassNames.content))},getVexByID:function(e){return s.getAllVexes().filter(function(){return $(this).data().vex.id===e})},close:function(e){if(!e){var n=s.getAllVexes().last();if(!n.length)return!1;e=n.data().vex.id}return s.closeByID(e)},closeAll:function(){var e=s.getAllVexes().map(function(){return $(this).data().vex.id}).toArray();return(null!=e?e.length:void 0)?($.each(e.reverse(),function(e,n){return s.closeByID(n)}),!0):!1},closeByID:function(e){var n=s.getVexByID(e);if(n.length){var t=n.data().vex.$vex,o=$.extend({},n.data().vex),i=function(){return o.beforeClose?o.beforeClose(n,o):void 0},l=function(){return n.trigger("vexClose",o),t.remove(),$("body").trigger("vexAfterClose",o),o.afterClose?o.afterClose(n,o):void 0};return a?i()!==!1&&t.unbind(s.animationEndEvent).bind(s.animationEndEvent,function(){return l()}).addClass(s.baseClassNames.closing):i()!==!1&&l(),!0}},closeByEscape:function(){var e=s.getAllVexes().map(function(){return $(this).data().vex.id}).toArray();if(!(null!=e?e.length:void 0))return!1;var n=Math.max.apply(Math,e),t=s.getVexByID(n);return t.data().vex.escapeButtonCloses!==!0?!1:s.closeByID(n)},setupBodyClassName:function(e){return $("body").bind("vexOpen.vex",function(){return $("body").addClass(s.baseClassNames.open)}).bind("vexAfterClose.vex",function(){return s.getAllVexes().length?void 0:$("body").removeClass(s.baseClassNames.open)})},hideLoading:function(){return $(".vex-loading-spinner").remove()},showLoading:function(){return s.hideLoading(),$("body").append('<div class="vex-loading-spinner '+s.defaultOptions.className+'"></div>')}};return s});